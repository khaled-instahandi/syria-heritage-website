# نظام إدارة المشاريع - التكامل مع الباك أند

## نظرة عامة

تم تطوير نظام إدارة المشاريع بتكامل كامل مع الباك أند، ويوفر إدارة شاملة للمشاريع مع الفلاتر والبحث المتقدم.

## الميزات المطورة

### 1. إدارة كاملة للمشاريع
- ✅ **إضافة مشاريع جديدة** - إمكانية إنشاء مشاريع جديدة مع كافة التفاصيل
- ✅ **تعديل المشاريع** - تحديث تفاصيل المشاريع الموجودة
- ✅ **حذف المشاريع** - حذف المشاريع مع تأكيد الحذف
- ✅ **عرض التفاصيل** - مشاهدة تفاصيل كاملة لكل مشروع

### 2. نظام فلترة متقدم
- ✅ **البحث النصي** - البحث بأسماء المساجد عربي وإنجليزي
- ✅ **فلتر الحالة** - قيد الدراسة، قيد التنفيذ، مكتمل
- ✅ **فلتر النوع** - ترميم، إعادة إعمار
- ✅ **تصفية الصفحات** - نظام pagination مع إدارة البيانات

### 3. واجهة مستخدم محسنة
- ✅ **عرض جدول** - عرض المشاريع في جدول مفصل
- ✅ **عرض بطاقات** - عرض بصري جذاب للمشاريع
- ✅ **إحصائيات حية** - إحصائيات تتحدث تلقائياً
- ✅ **تحديث مباشر** - تحديث البيانات في الوقت الفعلي

## البنية التقنية

### 1. ملفات API (lib/api.ts)
```typescript
// وظائف إدارة المشاريع
api.getProjects(filters)      // جلب المشاريع مع الفلترة
api.getProject(id)            // جلب مشروع واحد
api.createProject(data)       // إنشاء مشروع جديد
api.updateProject(id, data)   // تحديث مشروع
api.deleteProject(id)         // حذف مشروع
```

### 2. نوع البيانات (lib/types.ts)
```typescript
interface Project {
  id: number
  mosque_ar: string         // اسم المسجد بالعربية
  mosque_en: string         // اسم المسجد بالإنجليزية
  project_category: "ترميم" | "إعادة إعمار"
  status: "قيد الدراسة" | "قيد التنفيذ" | "مكتمل"
  total_cost: string        // التكلفة الإجمالية
  progress_percentage: number // نسبة الإنجاز
  approved_by?: string      // الموافق عليه من قبل
  approved_at?: string      // تاريخ الموافقة
  published_at?: string     // تاريخ النشر
  created_at: string        //  تاريخ البناء
}
```

### 3. Hook المخصص (hooks/use-projects.tsx)
```typescript
const {
  projects,           // قائمة المشاريع
  loading,           // حالة التحميل
  error,             // رسائل الخطأ
  pagination,        // معلومات التصفح
  filters,           // الفلاتر الحالية
  stats,             // الإحصائيات
  
  // الإجراءات
  fetchProjects,     // جلب المشاريع
  createProject,     // إنشاء مشروع
  updateProject,     // تحديث مشروع
  deleteProject,     // حذف مشروع
  setFilters,        // تعديل الفلاتر
  refresh            // تحديث البيانات
} = useProjects()
```

### 4. مكونات UI المخصصة

#### حوار إنشاء/تعديل المشاريع
```typescript
// components/ui/project-form-dialog.tsx
<ProjectFormDialog
  open={showDialog}
  onOpenChange={setShowDialog}
  mode="create" | "edit"
  project={project}      // للتعديل فقط
  onSave={handleSave}
/>
```

#### حوار تأكيد الحذف
```typescript
// components/ui/delete-project-dialog.tsx
<DeleteProjectDialog
  project={project}
  onDelete={handleDelete}
/>
```

## نقاط التكامل مع الباك أند

### 1. API Endpoints المستخدمة
```
GET    /api/projects              # جلب المشاريع مع الفلترة
GET    /api/projects/{id}         # جلب مشروع واحد
POST   /api/projects              # إنشاء مشروع جديد
PUT    /api/projects/{id}         # تحديث مشروع
DELETE /api/projects/{id}         # حذف مشروع
```

### 2. معايير الفلترة المرسلة
```typescript
{
  page?: number                   // رقم الصفحة
  per_page?: number              // عدد العناصر في الصفحة
  search?: string                // نص البحث
  project_category?: string      // نوع المشروع
  status?: string                // حالة المشروع
  approved_by?: string           // الموافق عليه
  date_from?: string             // تاريخ البداية
  date_to?: string               // تاريخ النهاية
}
```

### 3. شكل البيانات المستلمة
```json
{
  "data": [
    {
      "id": 1,
      "mosque_ar": "سيبسيبيس",
      "mosque_en": "eg",
      "project_category": "ترميم",
      "status": "مكتمل",
      "total_cost": "4560.00",
      "progress_percentage": 95,
      "approved_by": "Admin User",
      "approved_at": "2025-08-14T00:00:00.000000Z",
      "published_at": "2025-08-14T00:00:00.000000Z",
      "created_at": "2025-08-14T18:31:37.000000Z"
    }
  ],
  "meta": {
    "current_page": 1,
    "total": 2,
    "per_page": 10,
    "last_page": 1
  },
  "links": {
    "first": "...",
    "last": "...",
    "prev": null,
    "next": null
  }
}
```

## إدارة الأخطاء

### 1. معالجة أخطاء الشبكة
- تحديد نوع الخطأ (اتصال، خادم، مصادقة)
- عرض رسائل خطأ واضحة باللغة العربية
- إمكانية إعادة المحاولة

### 2. التحقق من البيانات
- فحص البيانات قبل الإرسال
- عرض رسائل الخطأ في النموذج
- منع الإرسال في حالة وجود أخطاء

### 3. التغذية الراجعة للمستخدم
- رسائل نجاح العمليات
- رسائل خطأ واضحة
- مؤشرات التحميل

## الاستخدام

### 1. الوصول للصفحة
```
/dashboard/projects
```

### 2. العمليات المتاحة

#### إضافة مشروع جديد
1. اضغط على زر "مشروع جديد"
2. املأ النموذج بالتفاصيل المطلوبة
3. اضغط "إضافة المشروع"

#### تعديل مشروع
1. اضغط على أيقونة التعديل في الجدول
2. عدل التفاصيل في النموذج
3. اضغط "حفظ التغييرات"

#### حذف مشروع
1. اضغط على أيقونة الحذف
2. أكد الحذف في الحوار المنبثق

#### فلترة المشاريع
- استخدم حقل البحث للبحث النصي
- اختر حالة المشروع من القائمة المنسدلة
- اختر نوع المشروع من القائمة المنسدلة

## الميزات المستقبلية

### مخطط لها
- [ ] تصدير البيانات (Excel, PDF)
- [ ] فلاتر متقدمة (تاريخ، مبلغ)
- [ ] رفع المرفقات للمشاريع
- [ ] تتبع تاريخ التغييرات
- [ ] نظام الموافقات المتعددة
- [ ] إشعارات للتحديثات

## التشغيل والاختبار

### 1. التأكد من اتصال الباك أند
```bash
# تحقق من متغير البيئة
NEXT_PUBLIC_API_BASE_URL=https://back-aamar.academy-lead.com/api
```

### 2. اختبار الوظائف
- جرب إضافة مشروع جديد
- اختبر تعديل المشاريع الموجودة
- تحقق من عمل الفلاتر
- اختبر حذف المشاريع

### 3. مراقبة الأخطاء
- راقب console المتصفح للأخطاء
- تحقق من Network tab لاستجابة الـ API
- راجع رسائل الخطأ في واجهة المستخدم

## الدعم التقني

في حالة وجود مشاكل:
1. تحقق من اتصال الإنترنت
2. تأكد من عمل الباك أند
3. راجع console المتصفح للأخطاء
4. تحقق من صحة التوثيق (token)

## ملاحظات التطوير

- الكود يستخدم TypeScript للأمان والدقة
- نظام الحالة يدير البيانات بكفاءة
- المكونات قابلة لإعادة الاستخدام
- نظام الفلترة يدعم البحث المتقدم
- واجهة المستخدم مستجيبة على جميع الأجهزة
